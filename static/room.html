<!DOCTYPE html>
<html>
<head>
    <title>DrawMyGame</title>
    <style>
        html, body {
            padding: 0;
            margin: 0;
            height: 100%;
        }
        body, flexcol, flexrow {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: .5em;
        }
        body, flexcol {
            flex-direction: column;
        }
        flexrow {
            flex-direction: row;
        }
        .fill {
            flex: 1;
        }
        /* #aspect_ratio_wrapper {
            outline: 1px solid lightgrey;
            width: 500px;
            height: 500px;
        } */
    </style>
</head>
<body style="padding: 1em; gap: 1em; justify-content: start">
    <flexcol id="game_wrapper"></flexcol>
<script type="module">
import { GameMap, Game } from '../static/game.mjs'

const urlQueryStr = window.location.search
const urlParams = new URLSearchParams(urlQueryStr)

const locPathnames = location.pathname.split('/')
const roomId = locPathnames[locPathnames.length-1]

const gameWrapperEl = document.getElementById("game_wrapper")
const map = new GameMap()
let game = null

// main

async function main() {
    await getMap() 
    startGame()
}

async function getMap() {
    const res = await fetch(`/room/${roomId}/map`)
    const mapBin = await res.arrayBuffer()
    await map.importFromBinary(mapBin)
}

function startGame() {
    if(game) {
        game.playing = false
        gameWrapperEl.innerHTML = ""
        game = null
    }
    game = new Game(gameWrapperEl, map)
}

main()
</script>
</body>
</html> 